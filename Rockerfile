# See https://github.com/grammarly/rocker for documentation.
##### Build image #####
FROM golang:1.7

# Bootstrap requirements
COPY ./script/ /script/
RUN /script/bootstrap

# Get source in place
COPY ./ /go/src/docwhat.org/docker-gc/
WORKDIR /go/src/docwhat.org/docker-gc

# Test
RUN ./script/test

# Lint
RUN ./script/lint

# Build binary
RUN ./script/build docker

MOUNT ./:/src/
RUN cp docker-gc_linux_amd64 /src/

##### Run image #####
FROM scratch
MAINTAINER Christian HÃ¶ltje <docwhat@gerf.org>
ENV COLUMNS 80
COPY ["docker-gc_linux_amd64", "/docker-gc"]
ENTRYPOINT ["/docker-gc"]
TAG docker-gc:{{ if .Version }}{{ .Version }}{{ else }}devel{{ end }}
TAG docker-gc:latest

# vim: set ft=dockerfile :
